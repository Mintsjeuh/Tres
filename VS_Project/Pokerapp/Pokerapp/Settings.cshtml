@using WebMatrix.Data

@{
    Layout = "~/_Layout.cshtml";

    string connectionString = @"Data Source=(LocalDB)\MSSQLLocalDB;AttachDbFilename=|DataDirectory|\Database.mdf;Integrated Security=True";
    string provider = "System.Data.SqlClient";
    Database db = Database.OpenConnectionString(connectionString, provider);

    //Mogen comments bij
    Validation.Add("nr_players", Validator.StringLength(2, 1, "MESSAGE"));
    Validation.Add("round_time", Validator.StringLength(8, 8, "MESSAGE"));
    Validation.Add("pause_time", Validator.StringLength(8, 0, "MESSAGE"));
    Validation.Add("blind_time", Validator.StringLength(8, 0, "MESSAGE"));
    Validation.Add("min_table", Validator.StringLength(2, 1, "MESSAGE"));
    Validation.Add("max_table", Validator.StringLength(2, 1, "MESSAGE"));
    Validation.Add("start_value", Validator.StringLength(3, 1, "MESSAGE"));
    Validation.Add("table_amount", Validator.StringLength(2, 1, "MESSAGE"));
    Validation.Add("rebuy", Validator.StringLength(1, 1, "MESSAGE"));
    Validation.Add("chip1", Validator.StringLength(3, 1, "MESSAGE"));
    Validation.Add("chip2", Validator.StringLength(3, 1, "MESSAGE"));
    Validation.Add("chip3", Validator.StringLength(3, 1, "MESSAGE"));
    Validation.Add("chip4", Validator.StringLength(3, 1, "MESSAGE"));
    Validation.Add("chip5", Validator.StringLength(3, 1, "MESSAGE"));
    Validation.Add("small", Validator.StringLength(3, 1, "MESSAGE"));
    Validation.Add("small", Validator.StringLength(3, 1, "MESSAGE"));

    string url = Request.Url.AbsolutePath;
    string urlcode = url.Substring(url.Length - 7);
    int code = Convert.ToInt32(urlcode);

    int nr_players = 6;
    var round_time = "00:30:00";
    var pause_time = "00:00:00";
    var blind_time = "00:00:00";
    int min_table = 4;
    int max_table_amount = 6;
    int start_value = 10;
    int table_amount = 1;
    int rebuy = 0;
    int chip_worth1 = 1;
    int chip_worth2 = 2;
    int chip_worth3 = 3;
    int chip_worth4 = 4;
    int chip_worth5 = 5;
    int small = 5;
    int big = 10;

    var room = db.QueryValue("SELECT Room_Code FROM Room WHERE Room_Code = @0", code);
    if (room == code)
    {
        //Comments plz
        nr_players = Convert.ToInt32(db.QueryValue("SELECT Nr_Of_Players FROM Room WHERE Room_Code = @0", code));
        round_time = Convert.ToString(db.QueryValue("SELECT Round_Time FROM Room WHERE Room_Code = @0", code));
        pause_time = Convert.ToString(db.QueryValue("SELECT Pause_Time FROM Room WHERE Room_Code = @0", code));
        blind_time = Convert.ToString(db.QueryValue("SELECT Blind_Time FROM Room WHERE Room_Code = @0", code));
        min_table = Convert.ToInt32(db.QueryValue("SELECT Tbl_Min_Size FROM Room WHERE Room_Code = @0", code));
        max_table_amount = Convert.ToInt32(db.QueryValue("SELECT Tbl_Max_Size FROM Room WHERE Room_Code = @0", code));
        start_value = Convert.ToInt32(db.QueryValue("SELECT Start_Value FROM Room WHERE Room_Code = @0", code));
        table_amount = Convert.ToInt32(db.QueryValue("SELECT Tbl_Amount FROM Room WHERE Room_Code = @0", code));
        rebuy = Convert.ToInt32(db.QueryValue("SELECT Allow_Rebuy FROM Room WHERE Room_Code = @0", code));
        chip_worth1 = Convert.ToInt32(db.QueryValue("SELECT Chip_1_Worth FROM Room WHERE Room_Code = @0", code));
        chip_worth2 = Convert.ToInt32(db.QueryValue("SELECT Chip_2_Worth FROM Room WHERE Room_Code = @0", code));
        chip_worth3 = Convert.ToInt32(db.QueryValue("SELECT Chip_3_Worth FROM Room WHERE Room_Code = @0", code));
        chip_worth4 = Convert.ToInt32(db.QueryValue("SELECT Chip_4_Worth FROM Room WHERE Room_Code = @0", code));
        chip_worth5 = Convert.ToInt32(db.QueryValue("SELECT Chip_5_Worth FROM Room WHERE Room_Code = @0", code));
        small = Convert.ToInt32(db.QueryValue("SELECT Small_Blind FROM Room WHERE Room_Code = @0", code));
        big = Convert.ToInt32(db.QueryValue("SELECT Big_Blind FROM Room WHERE Room_Code = @0", code));
    }

    if (IsPost && Validation.IsValid() && Request.UrlReferrer.AbsolutePath == Request.Url.AbsolutePath)
    {
        if (Request["next"] == "Proceed")
        {
            string Url = "AdminPage.cshtml/" + code;
            Response.Redirect("~/" + Url);
        }
        else if (Request["save"] == "Save")
        {
            int players = Convert.ToInt32(Request["nr_players"]);
            var time = Request["round_time"];
            int min_table_size = Convert.ToInt32(Request["min_table"]);
            int max_table_size = Convert.ToInt32(Request["max_table"]);
            int allow_rebuy = Convert.ToInt32(Request["rebuy"]);
            var pause = Request["pause_time"];
            var blind = Request["blind_time"];
            int value = Convert.ToInt32(Request["start_value"]);
            int tbl_amount = Convert.ToInt32(Request["tbl_amount"]);
            int chip1 = Convert.ToInt32(Request["chip1"]);
            int chip2 = Convert.ToInt32(Request["chip2"]);
            int chip3 = Convert.ToInt32(Request["chip3"]);
            int chip4 = Convert.ToInt32(Request["chip4"]);
            int chip5 = Convert.ToInt32(Request["chip5"]);
            var started = 0;
            int small_blind = Convert.ToInt32(Request["small"]);
            int big_blind = Convert.ToInt32(Request["big"]);

            var check = db.QueryValue("SELECT Room_Code FROM Room WHERE Room_Code = @0", code);
            if (check == code)
            {
                db.Execute("UPDATE Room SET Room_Code = @0, Nr_Of_Players = @1, Tbl_Min_Size = @2, Started = @3, Chip_1_Worth = @4, Chip_2_Worth = @5, Chip_3_Worth = @6, Chip_4_Worth = @7, Chip_5_Worth = @8, Round_Time = @9, Pause_Time = @10, Blind_Time = @11, Allow_Rebuy = @12, Start_Value = @13, Tbl_Amount = @14, Tbl_Max_Size = @15, Small_Blind = @16, Big_Blind = @17 WHERE Room_Code = @0"
                , code, players, min_table_size, started, chip1, chip2, chip3, chip4, chip5, time, pause, blind, allow_rebuy, value, tbl_amount, max_table_size, small_blind, big_blind);
            }
            else
            {
                db.Execute("INSERT INTO Room (Room_Code, Nr_Of_Players, Tbl_Min_Size, Started, Chip_1_Worth, Chip_2_Worth, Chip_3_Worth, Chip_4_Worth, Chip_5_Worth, Round_Time, Pause_Time, Blind_Time, Allow_Rebuy, Start_Value, Tbl_Amount, Tbl_Max_Size, Small_Blind, Big_Blind)" +
                "VALUES (@0, @1, @2, @3, @4, @5, @6, @7, @8, @9, @10, @11, @12, @13, @14, @15, @16, @17)", code, players, min_table_size, started, chip1, chip2, chip3, chip4, chip5, time, pause, blind, allow_rebuy, value, tbl_amount, max_table_size, small_blind, big_blind);
            }

            string Url = "Settings.cshtml/" + code;
            Response.Redirect("~/" + Url);
        }
        else
        {
            Response.Redirect("~/Login.cshtml");
        }
    }
}

<html>
<head>
    <title>Settings</title>
    <style>
        .form-group {
            padding-right: 5px;
        }
    </style>
</head>
<body>
    <div class="py-5 text-center">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h3>Settings</h3>
                    <form style="display: inline-block" name="Settings" method="post">
                        <div class="form-row">
                            <div class="form-group col-md-6"> <label for="form1">Number of players</label> <input type="number" class="form-control" id="form1" placeholder="Number of players" name="nr_players " value="@nr_players"> </div>
                            @Html.ValidationMessage("nr_players")
                            <div class="form-group col-md-6"> <label for="form2">Start value</label> <input type="number" class="form-control" id="form2" placeholder="Start value" name="start_value" value="@start_value"> </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6"> <label for="form3">Time per round</label> <input type="number" class="form-control" id="form3" placeholder="9001" name="round_time" value="@round_time"> </div>
                            <div class="form-group col-md-6"> <label for="form4">Duration of pauses</label> <input type="number" class="form-control" id="form4" placeholder="9001" name="pause_time" value="@pause_time"> </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6"> <label for="form5">Interval for blinds</label> <input type="number" class="form-control" id="form5" placeholder="9001" name="blind_time" value="@blind_time"> </div>
                            <div class="form-group col-md-6"> <label for="form6">Minimum players per table</label> <input type="number" class="form-control" id="form6" placeholder="3" name="min_table" value="@min_table"> </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6"> <label for="form7">Maximum players per table</label> <input type="number" class="form-control" id="form7" placeholder="9001" name="max_table" value="@max_table_amount"> </div>
                            <div class="form-group col-md-6"> <label for="form8">Amount of tables</label> <input type="number" class="form-control" id="form8" placeholder="9001" name="table_amount" value="@table_amount"> </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6"> <label for="form9">Amount of rebuys</label> <input type="number" class="form-control" id="form9" placeholder="9001" name="rebuy" value="@rebuy"> </div>
                            <div class="form-group col-md-6"> <label for="form10">Value chip 1</label> <input type="number" class="form-control" id="form10" placeholder="9001" name="chip1" value="@chip_worth1"> </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6"> <label for="form11">Value chip 2</label> <input type="number" class="form-control" id="form11" placeholder="9001" name="chip2" value="@chip_worth2"> </div>
                            <div class="form-group col-md-6"> <label for="form12">Value chip 3</label> <input type="number" class="form-control" id="form12" placeholder="9001" name="chip3" value="@chip_worth3"> </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6"> <label for="form13">Value chip 4</label> <input type="number" class="form-control" id="form13" placeholder="9001" name="chip4" value="@chip_worth4"> </div>
                            <div class="form-group col-md-6"> <label for="form14">Value chip 5</label> <input type="number" class="form-control" id="form14" placeholder="9001" name="chip5" value="@chip_worth5"> </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6"> <label for="form15">Value small blind</label> <input type="number" class="form-control" id="form15" placeholder="9001" name="small" value="@small"> </div>
                            <div class="form-group col-md-6"> <label for="form16">Value big blind</label> <input type="number" class="form-control" id="form16" placeholder="9001" name="big" value="@big"> </div>
                        </div>
                            <button type="submit" name="save" class="btn btn-primary">Save</button>
                            
                    </form>
                    <form method="post">
                        <button class="btn btn-primary" type="submit" name="next" value="Proceed">Proceed</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>